<!DOCTYPE html>
<html lang="zh-Hant-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>熱衰竭</title>
  <!--Bootstrap CSS-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/style.css">
  <link rel="icon" href="image/webicon.ico" type="image/x-icon" />
  <link rel="shortcut icon" href="image/webicon.ico" type="image/x-icon" />
</head>
<style>
  body {
    overflow-x: hidden;
    margin: 0;
    font-size: 100%;
  }

  .comic-bg {
    height: 100vh;
    width: 100vw;
    overflow: hidden;
    background-image: url(image/all-need-to-use/content-comic-bg.png);
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center center;
    position: fixed;
    z-index: -100;
  }

  .bg-dark {
    background-color: #000000;
  }

  .visual-effect .content {
    padding-top: 3%;
    width: 300%;
    height: 100vh;
    display: flex;
    flex-wrap: nowrap;
  }

  /* custom scrollbar */
  body::-webkit-scrollbar {
    width: 16px;
  }

  ::-webkit-scrollbar-thumb {
    background-color: #585858;
    border-radius: 8px;
    border: 4px solid transparent;
    background-clip: content-box;
  }

  ::-webkit-scrollbar-thumb:hover {
    background-color: #000000;
  }

  /*menu*/
  #menu section .menu-bg {
    height: 100%;
    width: 100%;
    overflow: hidden;
    background-image: url(image/all-need-to-use/menu-bg.png);
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center center;
    position: fixed;
    z-index: -100;
  }

  /*選擇區CSS*/

  /*A-BL*/
  .rugay {
    background-image: url(image/after-morning-ing/bl/WebBG_yg.png);
    background-position: center;
    background-repeat: no-repeat;
    object-fit: contain;
  }

  .rugay .text {
    position: absolute;
    margin-top: 30vh;
    margin-left: 18vw;
    font-size: 0.8vw;
    font-weight: bold;
    z-index: 100;
  }

  /*B-G*/
  #branchB {
    overflow-x: hidden;
  }

  .crack-image-container img {
    position: absolute;
    object-fit: cover;
    opacity: 0;
  }

  /*C-R*/
  .content-story {
    z-index: 100;
  }

  #messyPath {
    stroke-dasharray: 23922;
    stroke-dashoffset: 23922;
    pointer-events: none;
    /* animation: dash 10s linear forwards; */
  }
</style>

<body>
  <audio id="audio" src="bgm/maou_bgm_piano08.mp3" autoplay loop></audio>
  <header>
    <div class="all-icon-container">
      <div class="burger icon" id="open-menu-button">
        <div class="icon-size">
          <img src="image/home/buger_icon.png" class="w-100">
        </div>
      </div>
      <div class="sound icon">
        <div class="icon-size">
          <img id="audioToggle" src="image/home/sound_icon.png" class="w-100">
        </div>
      </div>
    </div>
  </header>

  <div class="comic-bg"></div>
  <div class="container front-story">
    <div class="content col-12">
      <img src="image/after-morning-ing/after-morning-front.jpg" class="w-100">
    </div>
  </div>

  <div class="visual-effect">
    <div class="content horizontal-scroll-effect">
      <section class="panel">
        <img src="image/after-morning-ing/effect0115-1.png" style="height: 90vh">
      </section>
      <section class="panel">
        <img src="image/after-morning-ing/effect0115-2.png" style="height: 90vh">
      </section>
      <section class="panel">
        <img src="image/after-morning-ing/effect0115-3.png" style="height: 90vh">
      </section>
    </div>
  </div>

  <div class="container back-story" style="margin-top: 2%;">
    <div class="content col-12">
      <img src="image/after-morning-ing/childhood.jpg" class="w-100">
    </div>
  </div>

  <!--選擇區-->
  <div class="container choice-box">
    <div class="text d-flex flex-column justify-content-center align-items-center" style="margin-bottom: 2vh;">
      <div class="box choice-title">
        <h1>做出選擇</h1>
      </div>
      <div class="box choices" style="height: 60vh;">
        <div class="eachchoice">
          <div class="choicepic">
            <iframe src="choice-pic/effect-choice-ambl.html" frameborder="0" scrolling="no" framespacing="0"
              allowfullscreen="true"></iframe>
          </div>
          <div class="button-layout d-flex justify-content-end align-items-center">
            <a onclick="makeChoice(1)">
              <div class="button-container d-flex justify-content-center align-items-center">
                <div style="font-size: 2rem;">繼續</div>
              </div>
            </a>
          </div>
        </div>
        <div class="eachchoice">
          <div class="choicepic">
            <iframe src="choice-pic/effect-choice-amg.html" frameborder="0" scrolling="no" framespacing="0"
              allowfullscreen="true"></iframe>
          </div>
          <div class="button-layout d-flex justify-content-end align-items-center">
            <a onclick="makeChoice(2)">
              <div class="button-container d-flex justify-content-center align-items-center">
                <div style="font-size: 2rem;">繼續</div>
              </div>
            </a>
          </div>
        </div>
        <div class="eachchoice">
          <div class="choicepic">
            <iframe src="choice-pic/effect-choice-amr.html" frameborder="0" scrolling="no" framespacing="0"
              allowfullscreen="true"></iframe>
          </div>
          <div class="button-layout d-flex justify-content-end align-items-center">
            <a onclick="makeChoice(3)">
              <div class="button-container d-flex justify-content-center align-items-center">
                <div style="font-size: 2rem;">繼續</div>
              </div>
            </a>
          </div>
        </div>
      </div>
      <div class="box"></div>
    </div>
  </div>
  <!-- 分支 A-BL 的內容容器 -->
  <div class="choice-content " id="branchA">

    <div class="container blue-line">
      <div class="col-12">
        <img src="image/after-morning-ing/bl/front.jpg" class="w-100">
      </div>
    </div>
    <div class="rugay">
      <div class="container" style="position: relative;">
        <div class="text pic-opacity">
          <p style="-webkit-text-stroke: 0.2px #ffffff; font-weight: bold;">難道你也喜歡<br>翻車魚嗎？</p>
        </div>
        <img src="image/after-morning-ing/bl/rugay.png" class="w-100">
        <img src="image/after-morning-ing/bl/dont.png" class="w-50 pic-opacity dont"
          style="position: absolute; right: 0; bottom: -15vh;">
      </div>
    </div>
    <div class="back-story container">
      <div class="col-12">
        <img src="image/after-morning-ing/bl/back.jpg" class="w-100">
      </div>
    </div>

    <iframe id="addFrame" src="add_aftermor_bl.html"
      style="width: 100%; height: 1400px; border: none; display: none;"></iframe>

    <div class="go-next-web" style="display: flex; justify-content: flex-end; margin-bottom: 5%;">
      <a href="chapter3-page.html"><button>進入章節三</button></a>
    </div>
  </div>
  <!-- 分支 B-G 的內容容器 -->
  <div class="choice-content" id="branchB">
    <div class="container green-line">
      <div class="col-12">
        <img src="image/after-morning-ing/g/1.png" class="w-100">
      </div>
    </div>
    <div class="crack-effect container position-relative">
      <div class="crack-image-container">
        <img src="image/after-morning-ing/g/crack-1.png" alt="Image 1" id="crack-1" class="w-100">
        <img src="image/after-morning-ing/g/crack-2.png" alt="Image 2" id="crack-2" class="w-100">
        <img src="image/after-morning-ing/g/crack-3.png" alt="Image 3" id="crack-3" class="w-100">
        <img src="image/after-morning-ing/g/crack-4.png" alt="Image 4" id="crack-4" class="w-100">
        <img src="image/after-morning-ing/g/crack-5.png" alt="Image 5" id="crack-5" class="w-100">
        <!--<img src="image/after-morning-ing/g/crack-6.png" alt="Image 6" id="crack-6" class="w-100">-->
      </div>
      <img src="image/after-morning-ing/g/front.png" class="w-100 crack-content">
    </div>
    <div class="back-story container">
      <div class="col-12">
        <img src="image/after-morning-ing/g/back.png" class="w-100">
      </div>
    </div>
    <iframe id="addFrame" src="add_aftermor_all.html"
      style="width: 100%; height: 1400px; border: none; display: none;"></iframe>
    <div class="go-next-web" style="display: flex; justify-content: flex-end; margin-bottom: 5%;">
      <a href="chapter3-page.html"><button>進入章節三</button></a>
    </div>
  </div>
  <!-- 分支 C-R 的內容容器 -->
  <div class="choice-content" id="branchC">
    <div class="container">
      <div class="messy-line-effect position-relative">
        <div class="content-story container position-absolute">
          <img src="image/after-morning-ing/r/r-story.png" class="w-100">
        </div>
        <div class="path-container container position-absolut ">
          <svg viewBox="0 0 1730 2488" fill="none" xmlns="http://www.w3.org/2000/svg"
            preserveAspectRatio="xMidYMid meet">
            <path id="messyPath"
              d="M1097 0.5C1087.83 112.333 945.3 329.2 448.5 302C-172.5 268 -121 107 448.5 214.5C1018 322 1466 417.5 1527.5 381.5C1589 345.5 275.999 292 200.499 349.5C124.999 407 534 331.5 637 349.5C740 367.5 214.499 381.5 200.499 427C186.5 472.5 1615.5 641 1571.5 476.5C1527.5 312 353.5 480.5 264 540C174.5 599.5 1073 502.5 1160.5 504.5C1248 506.5 1341.5 576 1325.5 627.5C1309.5 679 388.5 641.5 357 693C325.5 744.5 825.5 714.5 1075.5 595.5C1325.5 476.5 1438.5 603.5 1428.5 659C1418.5 714.5 654.5 556.5 666.5 752.5C678.5 948.5 1543.5 659 1621 778C1698.5 897 1015.5 706.5 966 778C916.5 849.5 1531.5 827.5 1603 913C1674.5 998.5 1063.5 847.5 1047.5 913C1031.5 978.5 1618.5 837.5 1650.5 891C1682.5 944.5 1198 972 1214 1071.5C1230 1171 1742 982 1728 1131C1714 1280 1307 1183 1160.5 1222.5C1043.3 1254.1 1055 1383.67 1075.5 1444.5C1139.67 1435.33 1276.3 1430.5 1309.5 1484.5C1351 1552 892.5 1514.5 914.5 1484.5C936.5 1454.5 1341.5 1466.5 1325.5 1538C1309.5 1609.5 914.5 1462.5 914.5 1538C914.5 1613.5 1333.5 1413 1369 1516C1404.5 1619 871 1562 879 1601.5C880.672 1609.76 897.136 1614.04 921.956 1616.22M921.956 1616.22C1015.87 1624.49 1229.42 1602.77 1214 1653C1194.5 1716.5 964.912 1547.95 921.956 1616.22ZM921.956 1616.22C934.804 1635.82 995.4 1682.5 1135 1712.5C1226 1746 1194.5 1766 1135 1768C1075.5 1770 532 1693 643 1792C754 1891 1178.5 1924.5 1182.5 1881C1186.5 1837.5 801 1811.5 722 1881C643 1950.5 1019.5 1884.5 1047.5 1930.5C1075.5 1976.5 912.5 1861.5 855 1901C797.5 1940.5 960.5 1937 1018 1978.5C1064 2011.7 1075.5 2251.33 1075.5 2367V2488"
              stroke="black" stroke-width="3" />
          </svg>
        </div>
      </div>
    </div>
    <iframe id="addFrame" src="add_aftermor_all.html"
      style="width: 100%; height: 1400px; border: none; display: none; position: relative; top: 185vh;"></iframe>
    <div class="go-next-web"
      style="display: flex; justify-content: flex-end; margin-bottom: 5%; position: relative; top: 190vh;">
      <a href="chapter3-page.html"><button>進入章節三</button></a>
    </div>
  </div>

  <div id="menu">
    <section>
      <div class="menu-bg"></div>
      <div class="all-icon-container">
        <div class="close icon" id="close-menu-button">
          <div class="icon-size">
            <img src="image/all-need-to-use/burger-close-icon.png" class="w-100">
          </div>
        </div>
      </div>
      <div class="container d-flex">
        <div class="col-12">
          <div class="content-container d-flex justify-content-center align-items-center" style="height: 100vh;">
            <div class="line-content-box">
              <div class="note-layout" style="width: 100%;">
                <div class="note-date-image d-flex justify-content-end">
                  <img src="image/all-need-to-use/note-date.png" style="width: 10vw; padding-right: 20px;">
                </div>
              </div>
              <ul style="padding: 0 1.8vw;">
                <li>
                  <span class="menu-topic-text">目錄<span class="small-size-text">MENU</span></span>
                </li>
                <li>
                  <a href="index.html">
                    <div class="menu-option">
                      首頁.
                      <div class="hover-line"></div>
                    </div>
                  </a>
                </li>
                <li>
                  <a href="mobile-chapter-list-page.html">
                    <div class="menu-option">
                      劇情章節.
                      <div class="hover-line"></div>
                    </div>
                  </a>
                </li>
                <li>
                  <a href="mobile-message-page.html">
                    <div class="menu-option">
                      我有話要說.
                      <div class="hover-line"></div>
                    </div>
                  </a>
                </li>
                <li>
                  <a href="mobile-an-ti-bullying-information.html">
                    <div class="menu-option">
                      反霸凌資訊.
                      <div class="hover-line"></div>
                    </div>
                  </a>
                </li>
                <li>
                  <a href="mobile-reference.html">
                    <div class="menu-option">
                      引用資料.
                      <div class="hover-line"></div>
                    </div>
                  </a>
                </li>
                <li>
                  <a href="mobile-about-us.html">
                    <div class="menu-option">
                      關於我們.
                      <div class="hover-line"></div>
                    </div>
                  </a>
                </li>
                <li>
                  <div class="border"></div>
                </li>
              </ul>
              <div class="pen-layout position-absolute" style="bottom: -50px; right: -100px; width: 25vw;">
                <div class="pen-image">
                  <img src="image/all-need-to-use/menu-pen.png" style="width: 100%;">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.27/bundled/lenis.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  
  <script src="js/menu.js"></script>

  <script>
    openMenu();
    closeMenu();
    // 點擊音效開關按鈕時切換音效狀態
    document.getElementById('audioToggle').addEventListener('click', toggleAudio);

    gsap.registerPlugin(ScrollTrigger);

    //smooth scroll
    function smoothScroll() {
      const lenis = new Lenis()

      lenis.on('scroll', (e) => {
        console.log(e)
      })

      function raf(time) {
        lenis.raf(time)
        requestAnimationFrame(raf)
      }

      requestAnimationFrame(raf)
    }

    function horizontalScroll() {
      let sections = gsap.utils.toArray(".panel");

      gsap.to(sections, {
        xPercent: -100 * (sections.length - 1),
        ease: "none",
        scrollTrigger: {
          trigger: ".visual-effect .content",
          pin: true,
          scrub: 1,
          //snap: 1 / (sections.length - 1),
          start: "top top",
          end: () => "+=" + document.querySelector(".visual-effect .content").offsetWidth,
          // markers: true
        }
      });
    }

    function changeBgColor() {
      ScrollTrigger.create({
        trigger: ".visual-effect .content",
        start: "top 10%",
        end: () => "+=" + document.querySelector(".visual-effect .content").offsetWidth,

        onEnter: () => {
          gsap.to(".visual-effect .content", { duration: 1, backgroundColor: '#000000' })
        },

        onLeaveBack: () => {
          gsap.to(".visual-effect .content", { duration: 1, backgroundColor: '#ffffff' })
        },
      })

      ScrollTrigger.create({
        trigger: ".visual-effect .content",
        start: () => "+=" + document.querySelector(".visual-effect .content").offsetWidth,
        end: "bottom 35%",
        //marker: true,

        onEnter: () => {
          gsap.to(".visual-effect .content", { duration: 0.5, backgroundColor: '#ffffff' })
        },

        onLeaveBack: () => {
          gsap.to(".visual-effect .content", { duration: 0.5, backgroundColor: '#000000' })
        },
      })
    };

    changeBgColor();
    horizontalScroll();
    // smoothScroll();


    //選擇用//
    function makeChoice(choice) {
      // 隱藏所有分支內容
      document.querySelectorAll('.choice-content').forEach(content => {
        content.style.display = 'none';
      });


      // 根據不同的選擇，顯示相應的分支內容&補充資訊
      if (choice === 1) {
        document.querySelectorAll('#branchA').forEach(content => {
          content.style.display = 'block';
        });

        textScale();
        document.querySelectorAll('#addFrame').forEach(content => {
          content.style.display = 'block';
        });

      } else if (choice === 2) {
        document.querySelectorAll('#branchB').forEach(content => {
          content.style.display = 'block';
        });

        crackAnimation();
        document.querySelectorAll('#addFrame').forEach(content => {
          content.style.display = 'block';
        });

      } else if (choice === 3) {
        document.querySelectorAll('#branchC').forEach(content => {
          content.style.display = 'block';
        });
        messyPathAnimation();
        document.querySelectorAll('#addFrame').forEach(content => {
          content.style.display = 'block';
        });
      }

      // 隱藏選項區
      document.querySelectorAll('.choice-box').forEach(content => {
        content.style.display = 'none';
      });
    }

    //move//
    function movepic() {
      gsap.to(".choice-content", 1, {
        y: 100,
        ease: "power4.inOut",
      });
    }



    //A-BL//

    function textScale() {
      gsap.set(".pic-opacity", { autoAlpha: 0 })

      const tl = gsap.timeline({
        defaults: {
          duration: 1.2
        },
        scrollTrigger: {
          trigger: ".rugay",
          start: "top center",
          end: "bottom center",
          toggleActions: "play none none reverse",
          //markers: true
        }
      });

      tl
        .to(".rugay .text", { transformOrigin: "center center", autoAlpha: 1, scale: 6 })
        .to(".dont", { duration: 0.5, autoAlpha: 1, bottom: "0vh" }, "-=0.5")
    }

    //B-G//

    function crackAnimation() {
      const pinParent = document.querySelector(".crack-image-container");

      const crackImageAnimation = gsap.timeline({
        // x: 100,
        // ease: "bounce.out",
        scrollTrigger: {
          trigger: '.crack-content',
          start: 'top top',
          end: 'center top',
          pin: pinParent,
          pinSpacing: false,
          //markers: true,
          scrub: true,
        }
      });

      crackImageAnimation
        .to("#crack-1", { opacity: 1, })
        .to("#crack-2", { opacity: 1, })
        .to("#crack-3", { opacity: 1, })
        .to("#crack-4", { opacity: 1, })
        .to("#crack-5", { opacity: 1, })
        .to("#crack-6", { opacity: 1, })
    }

    //C-R//
    // print path length
    path = document.getElementById("messyPath");
    console.log(path.getTotalLength());

    function messyPathAnimation() {
      const tl = gsap.timeline({
        scrollTrigger: {
          trigger: ".path-container",
          start: "top top+=20%",
          end: "bottom top",
          scrub: true,
          //markers: true,
        }
      });

      tl.to("#messyPath", { strokeDashoffset: 0, duration: 10 });
    }


  </script>

</body>

</html>